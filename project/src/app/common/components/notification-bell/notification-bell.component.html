<div class="notification-bell-container">
  <button 
    class="notification-bell-button" 
    (click)="toggleDropdown()"
    type="button"
    [attr.aria-label]="'Thông báo'">
    <svg class="bell-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 2 16 2 16H22C22 16 19 14.25 19 9C19 5.13 15.87 2 12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    @if (unreadCount() > 0) {
      <span class="notification-badge">{{ unreadCount() > 99 ? '99+' : unreadCount() }}</span>
    }
  </button>

  @if (showDropdown()) {
    <div class="notification-dropdown">
      <div class="notification-dropdown-header">
        <h3>Thông báo</h3>
        <button class="view-all-button" (click)="navigateToNotificationsPage()">Xem tất cả</button>
      </div>
      
      <div class="notification-list">
        @if (isLoading()) {
          <div class="loading">Đang tải...</div>
        } @else if (notifications().length === 0) {
          <div class="empty">Không có thông báo nào</div>
        } @else {
          @for (notification of notifications(); track notification.notificationId) {
            <div 
              class="notification-item" 
              [class.unread]="!notification.isRead"
              role="button"
              tabindex="0"
              (click)="navigateToNotification(notification)"
              (keyup.enter)="navigateToNotification(notification)"
              (keyup.space)="navigateToNotification(notification)">
              <div class="notification-content">
                <div class="notification-title">{{ notification.title }}</div>
                <div class="notification-message">{{ notification.message }}</div>
                <div class="notification-time">{{ formatDate(notification.createdAt) }}</div>
              </div>
              @if (!notification.isRead) {
                <button 
                  class="mark-read-button"
                  (click)="markAsRead(notification, $event)"
                  type="button"
                  [attr.aria-label]="'Đánh dấu đã đọc'">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
                  </svg>
                </button>
              }
            </div>
          }
        }
      </div>
    </div>
  }
</div>

